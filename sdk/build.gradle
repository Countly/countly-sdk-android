apply plugin: 'com.android.library'
apply plugin: 'bintray-release'

//Plugin for generating test coverage reports.
//They are generated by calling the following from the root folder:
// ./gradlew createDebugCoverageReport
//apply plugin: 'jacoco-android'

buildscript {
  repositories {
    jcenter()
  }
  dependencies {
    classpath 'com.novoda:bintray-release:0.9.1'
    //classpath 'com.dicedmelon.gradle:jacoco-android:0.1.4'
  }
}

android {
  compileSdkVersion 29
  buildToolsVersion "29.0.2"

  defaultConfig {
    minSdkVersion 17
    targetSdkVersion 29
    versionCode 1
    versionName "20.11.4"

    testInstrumentationRunner 'ly.count.android.sdk.test.InstrumentationTestRunner'
    testHandleProfiling true
    testFunctionalTest true
  }
  buildTypes {
    debug {
      testCoverageEnabled = false
    }
    release {
      minifyEnabled false
      proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.pro'
    }
  }

  lintOptions {
    abortOnError false
  }

  // This enables long timeouts required on slow environments, e.g. Travis
  adbOptions {
    timeOutInMs 20 * 60 * 1000 // 20 minutes
    installOptions "-d", "-t"
  }
}

def mockitoVersion = "2.28.2"

dependencies {
  api fileTree(dir: 'libs', include: ['*.jar'])

  androidTestImplementation 'androidx.test:runner:1.2.0'
  androidTestImplementation 'androidx.test:rules:1.2.0'
  androidTestImplementation 'androidx.test.ext:junit:1.1.1'
  androidTestImplementation 'androidx.annotation:annotation:1.1.0'
  androidTestImplementation 'junit:junit:4.13'

  androidTestImplementation "org.mockito:mockito-core:${mockitoVersion}"
  androidTestImplementation "org.mockito:mockito-android:${mockitoVersion}"
}

publish {
  userOrg = 'countly'
  groupId = 'ly.count.android'
  artifactId = 'sdk'
  publishVersion = '20.11.4'
  desc = 'Android SDK for Countly mobile analytics'
  website = 'https://github.com/Countly/countly-sdk-android'
  autoPublish = false
}
